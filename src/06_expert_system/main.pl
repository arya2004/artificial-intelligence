% Book facts: name, author, genre, language, year, publisher, length, age_group
% Book facts: name, author, genre, language, year, publisher, length, age_group
% Book facts: name, author, genre, language, year, publisher, length, age_group
book('To Kill a Mockingbird', 'Harper Lee', fiction, english, 1960, penguin, medium, adults).
book('Harry Potter and the Sorcerer\'s Stone', 'J.K. Rowling', fantasy, english, 1997, bloomsbury, long, teens).
book('The Great Gatsby', 'F. Scott Fitzgerald', fiction, english, 1925, scribner, short, adults).
book('The Alchemist', 'Paulo Coelho', adventure, portuguese, 1988, harpercollins, medium, adults).
book('Don Quixote', 'Miguel de Cervantes', adventure, spanish, 1605, francisco, long, adults).
book('War and Peace', 'Leo Tolstoy', historical, russian, 1869, oxford, long, adults).
book('Charlotte\'s Web', 'E.B. White', kids, english, 1952, harpercollins, short, kids).
book('The Hobbit', 'J.R.R. Tolkien', fantasy, english, 1937, allen, medium, teens).
book('One Hundred Years of Solitude', 'Gabriel Garcia Marquez', magical_realism, spanish, 1967, harpercollins, long, adults).
book('Pride and Prejudice', 'Jane Austen', romance, english, 1813, penguin, medium, adults).
book('Moby Dick', 'Herman Melville', adventure, english, 1851, penguin, long, adults).
book('The Odyssey', 'Homer', epic, greek, -800, oxford, long, adults).
book('The Catcher in the Rye', 'J.D. Salinger', fiction, english, 1951, littlebrown, medium, adults).
book('Ulysses', 'James Joyce', modernist, english, 1922, sylvia, long, adults).
book('Crime and Punishment', 'Fyodor Dostoevsky', psychological, russian, 1866, penguin, long, adults).
book('Brave New World', 'Aldous Huxley', dystopian, english, 1932, chatto, medium, adults).
book('Jane Eyre', 'Charlotte Bronte', romance, english, 1847, smith, long, adults).
book('The Divine Comedy', 'Dante Alighieri', epic, italian, 1320, penguin, long, adults).
book('The Brothers Karamazov', 'Fyodor Dostoevsky', philosophical, russian, 1880, oxford, long, adults).
book('The Lord of the Rings', 'J.R.R. Tolkien', fantasy, english, 1954, allen, long, teens).
book('The Metamorphosis', 'Franz Kafka', absurdist, german, 1915, kurt, short, adults).
book('The Picture of Dorian Gray', 'Oscar Wilde', philosophical, english, 1890, lippincott, medium, adults).
book('Frankenstein', 'Mary Shelley', gothic, english, 1818, lackington, medium, adults).
book('The Iliad', 'Homer', epic, greek, -762, penguin, long, adults).
book('Dracula', 'Bram Stoker', horror, english, 1897, archibald, medium, adults).
book('Fahrenheit 451', 'Ray Bradbury', dystopian, english, 1953, ballantine, medium, adults).
book('Anna Karenina', 'Leo Tolstoy', romance, russian, 1877, oxford, long, adults).
book('The Grapes of Wrath', 'John Steinbeck', fiction, english, 1939, viking, long, adults).
book('The Old Man and the Sea', 'Ernest Hemingway', fiction, english, 1952, scribner, short, adults).
book('The Stranger', 'Albert Camus', philosophical, french, 1942, gallimard, short, adults).
book('Les MisÃ©rables', 'Victor Hugo', historical, french, 1862, pagnerre, long, adults).
book('Lolita', 'Vladimir Nabokov', psychological, english, 1955, olympia, medium, adults).
book('The Sound and the Fury', 'William Faulkner', modernist, english, 1929, jonathan, medium, adults).
book('Gone with the Wind', 'Margaret Mitchell', historical, english, 1936, macmillan, long, adults).
book('Wuthering Heights', 'Emily Bronte', gothic, english, 1847, thomas, medium, adults).
book('Heart of Darkness', 'Joseph Conrad', adventure, english, 1899, blackwood, short, adults).
book('The Bell Jar', 'Sylvia Plath', fiction, english, 1963, harper, medium, adults).
book('Dune', 'Frank Herbert', science_fiction, english, 1965, chilton, long, teens).
book('Catch-22', 'Joseph Heller', satire, english, 1961, simon, long, adults).
book('The Road', 'Cormac McCarthy', dystopian, english, 2006, knopf, medium, adults).
book('The Time Machine', 'H.G. Wells', science_fiction, english, 1895, heinemann, short, adults).
book('1984', 'George Orwell', dystopian, english, 1949, secker, medium, adults).
book('Slaughterhouse-Five', 'Kurt Vonnegut', science_fiction, english, 1969, delacorte, medium, adults).
book('A Clockwork Orange', 'Anthony Burgess', dystopian, english, 1962, william, medium, adults).
book('The Trial', 'Franz Kafka', philosophical, german, 1925, kurt, medium, adults).
book('Beloved', 'Toni Morrison', fiction, english, 1987, knopf, medium, adults).
book('The Master and Margarita', 'Mikhail Bulgakov', magical_realism, russian, 1967, penguin, medium, adults).
book('The Kite Runner', 'Khaled Hosseini', historical, english, 2003, riverhead, medium, adults).
book('Life of Pi', 'Yann Martel', adventure, english, 2001, knopf, medium, adults).
book('Midnight\'s Children', 'Salman Rushdie', magical_realism, english, 1981, jonathan, long, adults).
book('The Handmaid\'s Tale', 'Margaret Atwood', dystopian, english, 1985, mcclelland, medium, adults).
book('The Girl with the Dragon Tattoo', 'Stieg Larsson', crime, swedish, 2005, norstedts, long, adults).
book('Cloud Atlas', 'David Mitchell', science_fiction, english, 2004, randomhouse, long, adults).
book('The Book Thief', 'Markus Zusak', historical, english, 2005, knopf, medium, teens).
book('The Shining', 'Stephen King', horror, english, 1977, doubleday, long, adults).
book('It', 'Stephen King', horror, english, 1986, viking, long, adults).
book('The Da Vinci Code', 'Dan Brown', thriller, english, 2003, doubleday, long, adults).
book('The Hunger Games', 'Suzanne Collins', dystopian, english, 2008, scholastic, medium, teens).
book('The Fault in Our Stars', 'John Green', romance, english, 2012, dutton, medium, teens).
book('Twilight', 'Stephenie Meyer', fantasy, english, 2005, littlebrown, long, teens).
book('Divergent', 'Veronica Roth', dystopian, english, 2011, harpercollins, long, teens).
book('The Maze Runner', 'James Dashner', dystopian, english, 2009, delacorte, long, teens).
book('Ender\'s Game', 'Orson Scott Card', science_fiction, english, 1985, tor, medium, teens).
book('Ready Player One', 'Ernest Cline', science_fiction, english, 2011, crown, medium, teens).
book('The Giver', 'Lois Lowry', dystopian, english, 1993, houghton, short, teens).
book('Percy Jackson & the Olympians: The Lightning Thief', 'Rick Riordan', fantasy, english, 2005, hyperion, medium, teens).
book('Eragon', 'Christopher Paolini', fantasy, english, 2002, knopf, long, teens).
book('The Name of the Wind', 'Patrick Rothfuss', fantasy, english, 2007, daw, long, teens).
book('The Curious Incident of the Dog in the Night-Time', 'Mark Haddon', mystery, english, 2003, jonathan, medium, teens).
book('Wonder', 'R.J. Palacio', fiction, english, 2012, knopf, medium, kids).
book('Coraline', 'Neil Gaiman', fantasy, english, 2002, harpercollins, short, kids).
book('Holes', 'Louis Sachar', adventure, english, 1998, fsg, medium, kids).
book('The Chronicles of Narnia: The Lion, the Witch and the Wardrobe', 'C.S. Lewis', fantasy, english, 1950, harpercollins, medium, kids).
book('Matilda', 'Roald Dahl', fiction, english, 1988, viking, short, kids).
book('Charlie and the Chocolate Factory', 'Roald Dahl', fiction, english, 1964, knopf, short, kids).
book('The BFG', 'Roald Dahl', fantasy, english, 1982, jonathan, short, kids).
book('The Phantom Tollbooth', 'Norton Juster', adventure, english, 1961, randomhouse, medium, kids).
book('Winnie-the-Pooh', 'A.A. Milne', kids, english, 1926, methuen, short, kids).
book('Goodnight Moon', 'Margaret Wise Brown', kids, english, 1947, harper, short, kids).
book('The Very Hungry Caterpillar', 'Eric Carle', kids, english, 1969, penguin, short, kids).
book('Where the Wild Things Are', 'Maurice Sendak', kids, english, 1963, harper, short, kids).
book('The Gruffalo', 'Julia Donaldson', kids, english, 1999, macmillan, short, kids).
book('The Cat in the Hat', 'Dr. Seuss', kids, english, 1957, randomhouse, short, kids).
book('Alice\'s Adventures in Wonderland', 'Lewis Carroll', fantasy, english, 1865, macmillan, medium, kids).
book('Peter Pan', 'J.M. Barrie', fantasy, english, 1911, hodder, medium, kids).
book('The Wind in the Willows', 'Kenneth Grahame', fantasy, english, 1908, methuen, medium, kids).

% Additional book facts: name, author, genre, language, year, publisher, length, age_group
book('The Secret Garden', 'Frances Hodgson Burnett', fiction, english, 1911, harper, medium, kids).
book('Anne of Green Gables', 'L.M. Montgomery', fiction, english, 1908, lothrop, medium, kids).
book('Little Women', 'Louisa May Alcott', fiction, english, 1868, roberts, long, teens).
book('The Call of the Wild', 'Jack London', adventure, english, 1903, macmillan, short, adults).
book('Treasure Island', 'Robert Louis Stevenson', adventure, english, 1883, cassell, medium, kids).
book('Robinson Crusoe', 'Daniel Defoe', adventure, english, 1719, william, long, adults).
book('Black Beauty', 'Anna Sewell', fiction, english, 1877, jarrold, medium, kids).
book('Gulliver\'s Travels', 'Jonathan Swift', adventure, english, 1726, benj, medium, adults).
book('The Scarlet Letter', 'Nathaniel Hawthorne', fiction, english, 1850, ticknor, medium, adults).
book('Of Mice and Men', 'John Steinbeck', fiction, english, 1937, covici, short, adults).
book('A Tale of Two Cities', 'Charles Dickens', historical, english, 1859, chapman, medium, adults).
book('David Copperfield', 'Charles Dickens', fiction, english, 1850, bradbury, long, adults).
book('Oliver Twist', 'Charles Dickens', fiction, english, 1837, bentley, medium, adults).
book('Great Expectations', 'Charles Dickens', fiction, english, 1861, chapman, long, adults).
book('Hard Times', 'Charles Dickens', fiction, english, 1854, bradbury, medium, adults).
book('A Christmas Carol', 'Charles Dickens', fiction, english, 1843, chapman, short, adults).
book('Bleak House', 'Charles Dickens', fiction, english, 1853, bradbury, long, adults).
book('The Hound of the Baskervilles', 'Arthur Conan Doyle', mystery, english, 1902, george, medium, adults).
book('The Adventures of Sherlock Holmes', 'Arthur Conan Doyle', mystery, english, 1892, george, medium, adults).
book('The Three Musketeers', 'Alexandre Dumas', adventure, french, 1844, baudry, long, adults).
book('The Count of Monte Cristo', 'Alexandre Dumas', adventure, french, 1844, baudry, long, adults).
book('The Man in the Iron Mask', 'Alexandre Dumas', adventure, french, 1850, baudry, long, adults).
book('The Phantom of the Opera', 'Gaston Leroux', horror, french, 1910, pierre, medium, adults).
book('Journey to the Center of the Earth', 'Jules Verne', science_fiction, french, 1864, pierre, medium, teens).
book('Twenty Thousand Leagues Under the Sea', 'Jules Verne', science_fiction, french, 1870, pierre, long, adults).
book('Around the World in Eighty Days', 'Jules Verne', adventure, french, 1873, hetzel, medium, adults).
book('The War of the Worlds', 'H.G. Wells', science_fiction, english, 1898, heinemann, medium, adults).
book('The Invisible Man', 'H.G. Wells', science_fiction, english, 1897, cockerell, short, adults).
book('The Island of Doctor Moreau', 'H.G. Wells', science_fiction, english, 1896, heinemann, medium, adults).
book('Brave New World Revisited', 'Aldous Huxley', dystopian, english, 1958, chatto, short, adults).
book('A Room with a View', 'E.M. Forster', romance, english, 1908, edward, medium, adults).
book('Howard\'s End', 'E.M. Forster', fiction, english, 1910, edward, medium, adults).
book('The Remains of the Day', 'Kazuo Ishiguro', fiction, english, 1989, faber, medium, adults).
book('White Teeth', 'Zadie Smith', fiction, english, 2000, penguin, medium, adults).
book('On the Road', 'Jack Kerouac', fiction, english, 1957, viking, medium, adults).
book('The Sun Also Rises', 'Ernest Hemingway', fiction, english, 1926, scribner, medium, adults).
book('For Whom the Bell Tolls', 'Ernest Hemingway', fiction, english, 1940, scribner, long, adults).
book('The Old Curiosity Shop', 'Charles Dickens', fiction, english, 1841, chapman, long, adults).
book('To the Lighthouse', 'Virginia Woolf', modernist, english, 1927, hogarth, medium, adults).
book('Mrs Dalloway', 'Virginia Woolf', modernist, english, 1925, hogarth, medium, adults).
book('Orlando', 'Virginia Woolf', modernist, english, 1928, hogarth, medium, adults).
book('The Waves', 'Virginia Woolf', modernist, english, 1931, hogarth, medium, adults).
book('The Trial of Socrates', 'I.F. Stone', philosophical, english, 1988, penguin, medium, adults).
book('The Republic', 'Plato', philosophical, greek, -375, penguin, long, adults).
book('Thus Spoke Zarathustra', 'Friedrich Nietzsche', philosophical, german, 1883, penguin, medium, adults).
book('The Prince', 'Niccolo Machiavelli', political, italian, 1532, antonio, short, adults).
book('The Communist Manifesto', 'Karl Marx', political, german, 1848, engels, short, adults).
book('The Wealth of Nations', 'Adam Smith', economics, english, 1776, william, long, adults).
book('Capital', 'Karl Marx', political, german, 1867, otto, long, adults).
book('The Art of War', 'Sun Tzu', strategy, chinese, -500, penguin, short, adults).
book('The Art of Happiness', 'Dalai Lama', philosophical, english, 1998, riverhead, medium, adults).
book('Siddhartha', 'Hermann Hesse', philosophical, german, 1922, penguin, medium, adults).
book('The Power of Now', 'Eckhart Tolle', self_help, english, 1997, newworld, medium, adults).
book('The Road Less Traveled', 'M. Scott Peck', self_help, english, 1978, simon, medium, adults).
book('Man\'s Search for Meaning', 'Viktor Frankl', self_help, english, 1946, beacon, medium, adults).
book('The Seven Habits of Highly Effective People', 'Stephen Covey', self_help, english, 1989, simon, medium, adults).
book('The Power of Positive Thinking', 'Norman Vincent Peale', self_help, english, 1952, simon, medium, adults).
book('How to Win Friends and Influence People', 'Dale Carnegie', self_help, english, 1936, simon, medium, adults).
book('Think and Grow Rich', 'Napoleon Hill', self_help, english, 1937, ballou, medium, adults).
book('The Four Agreements', 'Don Miguel Ruiz', self_help, english, 1997, amberallen, short, adults).
book('Atomic Habits', 'James Clear', self_help, english, 2018, penguin, medium, adults).
book('Quiet: The Power of Introverts in a World That Can\'t Stop Talking', 'Susan Cain', self_help, english, 2012, crown, medium, adults).
book('The Subtle Art of Not Giving a F*ck', 'Mark Manson', self_help, english, 2016, harper, medium, adults).
book('Educated', 'Tara Westover', memoir, english, 2018, randomhouse, medium, adults).
book('Becoming', 'Michelle Obama', memoir, english, 2018, crown, medium, adults).
book('The Glass Castle', 'Jeannette Walls', memoir, english, 2005, scribner, medium, adults).
book('Wild', 'Cheryl Strayed', memoir, english, 2012, knopf, medium, adults).
book('Born a Crime', 'Trevor Noah', memoir, english, 2016, spiegel, medium, adults).
book('Steve Jobs', 'Walter Isaacson', biography, english, 2011, simon, long, adults).
book('The Wright Brothers', 'David McCullough', biography, english, 2015, simon, medium, adults).
book('Alexander Hamilton', 'Ron Chernow', biography, english, 2004, penguin, long, adults).



% Start book recommendation system
recommend_books :-
    write('Welcome to the Book Recommendation System!'), nl,
    write('Please answer the following questions to get a book recommendation.'), nl,
    
    ask_previous_book(PreviousBook),
    ( PreviousBook \= 'none' ->
        recommend_similar_book(PreviousBook)
    ;
        ask_author(Author),
        ask_genre(Genre),
        ask_language(Language),
        ask_year(Year),
        ask_publisher(Publisher),
        ask_length(Length),
        ask_age_group(AgeGroup),
        
        nl, write('Here are the recommended books based on your preferences:'), nl,
        find_books(Author, Genre, Language, Year, Publisher, Length, AgeGroup)
    ).

% Ask the user for a previously read book
ask_previous_book(PreviousBook) :-
    write('Do you want recommendations based on a previously read book? (Type the book name or "none") '), nl,
    read(UserInput),
    process_input(UserInput, PreviousBook).

% Process user input to handle "any" and specific inputs
process_input('any', any) :- !.
process_input(UserInput, UserInput).

% Find a book most similar to the given book
recommend_similar_book(PreviousBook) :-
    book(PreviousBook, Author, Genre, Language, Year, Publisher, Length, AgeGroup),
    find_similar_book(PreviousBook, Author, Genre, Language, Year, Publisher, Length, AgeGroup).

find_similar_book(PreviousBook, Author, Genre, Language, Year, Publisher, Length, AgeGroup) :-
    findall(
        [Name, SimilarityScore],
        ( book(Name, A, G, L, Y, P, Len, AG),
          Name \= PreviousBook, % Exclude the same book
          similarity_score([Author, Genre, Language, Year, Publisher, Length, AgeGroup], [A, G, L, Y, P, Len, AG], SimilarityScore)
        ),
        SimilarBooks),
    sort(2, @>=, SimilarBooks, SortedBooks), % Sort by similarity score in descending order
    SortedBooks = [[BestMatch, _] | _], % Pick the most similar book
    write('Based on your previously read book, we recommend: '), write(BestMatch), nl.

% Calculate similarity score between two books based on matching attributes
similarity_score([A1, G1, L1, Y1, P1, Len1, AG1], [A2, G2, L2, Y2, P2, Len2, AG2], Score) :-
    compare_attribute(A1, A2, AuthorScore),
    compare_attribute(G1, G2, GenreScore),
    compare_attribute(L1, L2, LanguageScore),
    compare_year(Y1, Y2, YearScore),
    compare_attribute(P1, P2, PublisherScore),
    compare_attribute(Len1, Len2, LengthScore),
    compare_attribute(AG1, AG2, AgeGroupScore),
    Score is AuthorScore + GenreScore + LanguageScore + YearScore + PublisherScore + LengthScore + AgeGroupScore.

% Compare attributes, 1 if they match, 0 otherwise (for "any" option, always return 1)
compare_attribute(any, _, 1) :- !.
compare_attribute(_, any, 1) :- !.
compare_attribute(X, X, 1) :- !.
compare_attribute(_, _, 0).

% Compare years, 1 if same, 0.5 if within 5 years, 0 otherwise
compare_year(any, _, 1) :- !.
compare_year(_, any, 1) :- !.
compare_year(Y1, Y2, 1) :- Y1 = Y2, !.
compare_year(Y1, Y2, 0.5) :- abs(Y1 - Y2) =< 5, !.
compare_year(_, _, 0).

% Ask the user about their preferences for each attribute (same as before)
ask_author(Author) :-
    write('Do you have a preferred author? (Type the name or "any") '), nl,
    read(UserInput),
    process_input(UserInput, Author).

ask_genre(Genre) :-
    write('What genre do you prefer? (e.g., fiction, fantasy, romance, or "any") '), nl,
    read(UserInput),
    process_input(UserInput, Genre).

ask_language(Language) :-
    write('Do you have a preferred language? (e.g., english, spanish, or "any") '), nl,
    read(UserInput),
    process_input(UserInput, Language).

ask_year(Year) :-
    write('Any preferred publication year? (Enter year or "any") '), nl,
    read(UserInput),
    process_input(UserInput, Year).

ask_publisher(Publisher) :-
    write('Any preferred publisher? (Type the name or "any") '), nl,
    read(UserInput),
    process_input(UserInput, Publisher).

ask_length(Length) :-
    write('Do you prefer short, medium, or long books? (Type or "any") '), nl,
    read(UserInput),
    process_input(UserInput, Length).

ask_age_group(AgeGroup) :-
    write('For what age group are you looking for? (kids, teens, adults, or "any") '), nl,
    read(UserInput),
    process_input(UserInput, AgeGroup).

% Find and display books matching the user's preferences
find_books(Author, Genre, Language, Year, Publisher, Length, AgeGroup) :-
    findall(
        [Name, MatchScore],
        ( book(Name, A, G, L, Y, P, Len, AG),
          similarity_score([Author, Genre, Language, Year, Publisher, Length, AgeGroup], [A, G, L, Y, P, Len, AG], MatchScore)
        ),
        MatchedBooks),
    sort(2, @>=, MatchedBooks, SortedBooks), % Sort by match score in descending order
    ( SortedBooks = [[BestMatch, _] | _] ->
        write('We recommend: '), write(BestMatch), nl
    ;
        write('No books match your preferences.'), nl
    ).




